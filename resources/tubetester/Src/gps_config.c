#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "shared.h"
#include "helpers.h"
#include "gps_config.h"

const uint8_t disable_gll[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x01, 0x00, 0xFB, 0x11};
const uint8_t disable_gsa[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x02, 0x00, 0xFC, 0x13};
const uint8_t disable_gsv[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x03, 0x00, 0xFD, 0x15};
const uint8_t disable_vtg[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x05, 0x00, 0xFF, 0x19};
const uint8_t disable_gga[] = {0xB5, 0x62, 0x06, 0x01, 0x03, 0x00, 0xF0, 0x00, 0x00, 0xFA, 0x0F};

const uint8_t disable_sbas[] = {0xB5, 0x62, 0x06, 0x16, 0x08, 0x00, 0x00, 0x03, 0x03, 0x00, 0x51, 0xA2, 0x06, 0x00, 0x23, 0xE7};;
const uint8_t pos_mode_stationary[] = {0xB5, 0x62, 0x06, 0x24, 0x24, 0x00, 0xFF, 0xFF, 0x02, 0x03, 0x00, 0x00, 0x00, 0x00, 0x10, 0x27, 0x00, 0x00, 0x05, 0x00, 0xFA, 0x00, 0xFA, 0x00, 0x64, 0x00, 0x2C, 0x01, 0x00, 0x3C, 0x00, 0x00, 0x00, 0x00, 0xC8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x16, 0xA0};
const uint8_t pwr_full_power[] = {0xB5, 0x62, 0x06, 0x86, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0x5A};
const uint8_t tp_50hz[] = {0xB5, 0x62, 0x06, 0x31, 0x20, 0x00, 0x00, 0x01, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x5D, 0xB6};
const uint8_t tp_1hz[] = {0xB5, 0x62, 0x06, 0x31, 0x20, 0x00, 0x00, 0x01, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0xFB, 0x4A};

void gps_say(const uint8_t* buf, int32_t len)
{
	HAL_UART_Transmit(gps_uart_ptr, (uint8_t*)buf, len, 200);
	HAL_Delay(50);
}

void gps_reset(void)
{
	HAL_GPIO_WritePin(GPS_RESET_GPIO_Port, GPS_RESET_Pin, GPIO_PIN_RESET);
	HAL_Delay(1);
	HAL_GPIO_WritePin(GPS_RESET_GPIO_Port, GPS_RESET_Pin, GPIO_PIN_SET);
	HAL_Delay(200);
}

void gps_init(void)
{
	// gps_reset();
	HAL_Delay(200);
	gps_say(disable_gll, sizeof(disable_gll));
	gps_say(disable_gsa, sizeof(disable_gsa));
	gps_say(disable_gsv, sizeof(disable_gsv));
	gps_say(disable_vtg, sizeof(disable_vtg));
	gps_say(disable_gga, sizeof(disable_gga));

	gps_say(disable_sbas, sizeof(disable_sbas));
	gps_say(pos_mode_stationary, sizeof(pos_mode_stationary));
	gps_say(pwr_full_power, sizeof(pwr_full_power));
	gps_say(tp_1hz, sizeof(tp_1hz));
}
